!(({languages, hooks}) => {
  (languages.erb = languages.extend("ruby", {})),
    languages.insertBefore("erb", "comment", {
      delimiter: { pattern: /^<%=?|%>$/, alias: "punctuation" },
    }),
    hooks.add("before-tokenize", e => {
      languages["markup-templating"].buildPlaceholders(
        e,
        "erb",
        /<%=?(?:[^\r\n]|[\r\n](?!=begin)|[\r\n]=begin\s(?:[^\r\n]|[\r\n](?!=end))*[\r\n]=end)+?%>/gm
      );
    }),
    hooks.add("after-tokenize", e => {
      languages["markup-templating"].tokenizePlaceholders(e, "erb");
    });
})(Prism);
